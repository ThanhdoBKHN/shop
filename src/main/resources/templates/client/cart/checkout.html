<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SHOP QUAN AO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Animate.css -->
    <link rel="stylesheet" th:href="@{/client/css/animate.css}">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" th:href="@{/client/css/icomoon.css}">
    <!-- Bootstrap  -->
    <link rel="stylesheet" th:href="@{/client/css/bootstrap.css}">

    <!-- Magnific Popup -->
    <link rel="stylesheet" th:href="@{/client/css/magnific-popup.css}">

    <!-- Flexslider  -->
    <link rel="stylesheet" th:href="@{/client/css/flexslider.css}">

    <!-- Theme style  -->
    <link rel="stylesheet" th:href="@{/client/css/style.css}">
    <link rel="stylesheet" th:href="@{/client/css/custome.css}">



</head>

<body>

<!--    header-->
<div th:replace="client/fragments/header"></div>
<!-- /.navbar -->

<!-- main -->
<div class="colorlib-shop">
    <div class="container">
        <div class="row row-pb-md">
            <div class="col-md-10 col-md-offset-1">
                <div class="process-wrap">
                    <div class="process text-center active">
                        <p><span>01</span></p>
                        <h3>Giỏ hàng</h3>
                    </div>
                    <div class="process text-center active">
                        <p><span>02</span></p>
                        <h3>Thanh toán</h3>
                    </div>
                    <div class="process text-center">
                        <p><span>03</span></p>
                        <h3>Hoàn tất thanh toán</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-7" id="userDetails">
<!--                <form method="post" class="colorlib-form">-->
<!--                    <h2>Chi tiết thanh toán</h2>-->
<!--                    <div class="row">-->
<!--                        <div class="col-md-6">-->
<!--                            <div class="form-group">-->
<!--                                <label for="fname">Họ & Tên</label>-->
<!--                                <input type="text" name="full" class="form-control" placeholder="Full Name">-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-md-12">-->
<!--                            <div class="form-group">-->
<!--                                <label for="fname">Địa chỉ</label>-->
<!--                                <input type="text" name="address" class="form-control"-->
<!--                                       placeholder="Nhập địa chỉ của bạn">-->
<!--                            </div>-->
<!--                        </div>-->

<!--                        <div class="form-group">-->
<!--                            <div class="col-md-6">-->
<!--                                <label for="email">Địa chỉ email</label>-->
<!--                                <input type="email" name="email" class="form-control"-->
<!--                                       placeholder="Ex: youremail@domain.com">-->
<!--                            </div>-->
<!--                            <div class="col-md-6">-->
<!--                                <label for="Phone">Số điện thoại</label>-->
<!--                                <input type="text" name="phone" class="form-control"-->
<!--                                       placeholder="Ex: 0123456789">-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="form-group">-->
<!--                            <div class="col-md-12">-->

<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

            </div>
            <div class="col-md-5">
                <div class="cart-detail">
                    <h2>Tổng Giỏ hàng</h2>
                    <ul>
                        <li>

                            <ul id="orderDetails">
<!--                                <li><span>1 x Tên sản phẩm</span> <span>₫ 990.000</span></li>-->
                            </ul>
                        </li>

                        <li id="sumPriceAll"><span>Tổng tiền đơn hàng</span> <span>₫ 1.370.000</span></li>
                    </ul>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <p><button th:href="@{/store}" id="checkoutOrder" type="submit" class="btn btn-primary">Thanh toán</button></p>
                    </div>
                </div>
            </div>
            </form>
        </div>
    </div>
</div>

<!-- end main -->
<!-- end main -->
<!--    footer-->
<div th:replace="client/fragments/footer"></div>
</div>

<!-- jQuery -->
<script th:src="@{/client/js/jquery.min.js}"></script>
<!-- jQuery Easing -->
<script th:src="@{/client/js/jquery.easing.1.3.js}"></script>
<!-- Bootstrap -->
<script th:src="@{/client/js/bootstrap.min.js}"></script>
<!-- Waypoints -->
<script th:src="@{/client/js/jquery.waypoints.min.js}"></script>
<!-- Flexslider -->
<script th:src="@{/client/js/jquery.flexslider-min.js}"></script>

<script th:src="@{/client/js/owl.carousel.min.js}"></script>
<!-- Magnific Popup -->
<script th:src="@{/client/js/jquery.magnific-popup.min.js}"></script>
<script th:src="@{/client/js/magnific-popup-options.js}"></script>

<!-- Stellar Parallax -->
<script th:src="@{/client/js/jquery.stellar.min.js}"></script>
<!-- Main -->
<script th:src="@{/client/js/main.js}"></script>

<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->

<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    // $.widget.bridge('uibutton', $.ui.button)
    function sumAll(sum){
        $("#sumPriceAll>*").remove()
        $("#sumPriceAll").append("<span>Tổng tiền đơn hàng</span> <span>"+sum+"</span>")
    }

    $.ajax({
        type: 'GET',
        url: 'http://localhost:8080/user-api',
        success: function (user) {
            $("#userDetails").append("                <form method=\"post\" class=\"colorlib-form\">\n" +
                "                    <h2>Chi tiết thanh toán</h2>\n" +
                "                    <div class=\"row\">\n" +
                "                        <div class=\"col-md-6\">\n" +
                "                            <div class=\"form-group\">\n" +
                "                                <label for=\"fname\">Họ & Tên</label>\n" +
                "                                <input type=\"text\" name=\"full\" class=\"form-control\" placeholder=\""+user.fullName+"\" value=\""+user.fullName+"\">\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"col-md-12\">\n" +
                "                            <div class=\"form-group\">\n" +
                "                                <label for=\"fname\">Địa chỉ</label>\n" +
                "                                <input type=\"text\" name=\"address\" class=\"form-control\"\n" +
                "                                       placeholder=\""+user.address+"\" value=\""+user.address+"\">\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "\n" +
                "                        <div class=\"form-group\">\n" +
                "                            <div class=\"col-md-6\">\n" +
                "                                <label for=\"email\">Địa chỉ email</label>\n" +
                "                                <input type=\"email\" name=\"email\" class=\"form-control\"\n" +
                "                                       placeholder=\""+user.email+"\" value=\""+user.email+"\">\n" +
                "                            </div>\n" +
                "                            <div class=\"col-md-6\">\n" +
                "                                <label for=\"Phone\">Số điện thoại</label>\n" +
                "                                <input type=\"text\" name=\"phone\" class=\"form-control\"\n" +
                "                                       placeholder=\""+user.phoneNumber+"\" value=\""+user.phoneNumber+"\">\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"form-group\">\n" +
                "                            <div class=\"col-md-12\">\n" +
                "\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                    </div>\n" +
                "\n" +
                "            </div>\n")
        }
    })

    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: "http://localhost:8080/user-api",
            async: false,
            success: function (user) {
                // let sum = 0
                $.ajax({
                    type: 'GET',
                    async: false,
                    url: 'http://localhost:8080/order-api?userid='+user.id,
                    success: function (orders) {
                        let sum = 0
                        orders.forEach(order => {
                            if(order.status == false){
                                $.ajax({
                                    type: 'GET',
                                    async: false,
                                    url: 'http://localhost:8080/productdetails-api?productId='+order.productId,
                                    success: function (productDetails) {
                                        $.ajax({
                                            type: 'GET',
                                            url: 'http://localhost:8080/product-api/product?productId='+productDetails.productId,
                                            success: function (product){
                                                sum += (product.price)*(order.quantity)
                                                $("#orderDetails").append("<li><span>"+order.quantity+" x "+product.name+"</span> <span>"+(order.quantity)*(product.price)+"</span></li>")
                                                sumAll(sum)
                                            }
                                        })
                                    }
                                })
                            }
                        })

                    }
                })

            }
        })
    })

    $("#checkoutOrder").click(function () {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/user-api',
            success: function (user) {
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:8080/order/update?userId='+user.id
                })
            }
        })
    })



</script>

<!--<script src="http://code.jquery.com/jquery-1.9.1.js"></script>-->
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

</body>

</html>