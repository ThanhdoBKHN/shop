<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SHOP QUAN AO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Animate.css -->
    <link rel="stylesheet" th:href="@{/client/css/animate.css}">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" th:href="@{/client/css/icomoon.css}">
    <!-- Bootstrap  -->
    <link rel="stylesheet" th:href="@{/client/css/bootstrap.css}">

    <!-- Magnific Popup -->
    <link rel="stylesheet" th:href="@{/client/css/magnific-popup.css}">

    <!-- Flexslider  -->
    <link rel="stylesheet" th:href="@{/client/css/flexslider.css}">

    <!-- Theme style  -->
    <link rel="stylesheet" th:href="@{/client/css/style.css}">
    <link rel="stylesheet" th:href="@{/client/css/custome.css}">



</head>

<body>

<!--    header-->
<div th:replace="client/fragments/header"></div>
<!-- /.navbar -->

<!-- main -->
<div class="colorlib-shop">
    <div class="container">
        <div class="row row-pb-md">
            <div class="col-md-10 col-md-offset-1">
                <div class="process-wrap">
                    <div class="process text-center active">
                        <p><span>01</span></p>
                        <h3>Giỏ hàng</h3>
                    </div>
                    <div class="process text-center">
                        <p><span>02</span></p>
                        <h3>Thanh toán</h3>
                    </div>
                    <div class="process text-center">
                        <p><span>03</span></p>
                        <h3>Hoàn tất thanh toán</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-pb-md">
            <div class="col-md-10 col-md-offset-1" id="cartList">
                <div class="product-name">
                    <div class="one-forth text-center">
                        <span>Chi tiết sản phẩm</span>
                    </div>
                    <div class="one-eight text-center">
                        <span>Giá</span>
                    </div>
                    <div class="one-eight text-center">
                        <span>Số lượng</span>
                    </div>
                    <div class="one-eight text-center">
                        <span>Tổng</span>
                    </div>
                    <div class="one-eight text-center">
                        <span>Xóa</span>
                    </div>
                </div>
<!--                <div class="product-cart">-->
<!--                    <div class="one-forth">-->
<!--                        <div class="product-img">-->
<!--                            <img class="img-thumbnail cart-img" src="images/ao-so-mi-hoa-tiet-den-asm1223-10191.jpg">-->
<!--                        </div>-->
<!--                        <div class="detail-buy">-->
<!--                            <h4>Mã : SP01</h4>-->
<!--                            <h5>Áo Khoác Nam Đẹp</h5>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="one-eight text-center">-->
<!--                        <div class="display-tc">-->
<!--                            <span class="price">680.000 đ</span>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="one-eight text-center">-->
<!--                        <div class="display-tc">-->
<!--                            <input type="number" id="quantity" name="quantity"-->
<!--                                   class="form-control input-number text-center" value="1">-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="one-eight text-center">-->
<!--                        <div class="display-tc">-->
<!--                            <span class="price">1.200.000 đ</span>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="one-eight text-center">-->
<!--                        <div class="display-tc">-->
<!--                            <a href="#" class="closed"></a>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->


            </div>
        </div>
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="total-wrap">
                    <div class="row">
                        <div class="col-md-8">

                        </div>
                        <div class="col-md-3 col-md-push-1 text-center" id="cartSumPrice">
<!--                            <div class="total">-->
<!--                                <div class="sub">-->
<!--                                    <p><span>Tổng:</span> <span class="sumPrice">4.000.000 đ</span></p>-->
<!--                                </div>-->
<!--                                <div class="grand-total">-->
<!--                                    <p><span><strong>Tổng cộng:</strong></span> <span class="sumPrice">3.550.000 đ</span></p>-->
<!--                                    <a href="checkout.html" class="btn btn-primary">Thanh toán <i-->
<!--                                            class="icon-arrow-right-circle"></i></a>-->
<!--                                </div>-->
<!--                            </div>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- end main -->
<!-- end main -->
<!--    footer-->
<div th:replace="client/fragments/footer"></div>
</div>

<!-- jQuery -->
<script th:src="@{/client/js/jquery.min.js}"></script>
<!-- jQuery Easing -->
<script th:src="@{/client/js/jquery.easing.1.3.js}"></script>
<!-- Bootstrap -->
<script th:src="@{/client/js/bootstrap.min.js}"></script>
<!-- Waypoints -->
<script th:src="@{/client/js/jquery.waypoints.min.js}"></script>
<!-- Flexslider -->
<script th:src="@{/client/js/jquery.flexslider-min.js}"></script>

<script th:src="@{/client/js/owl.carousel.min.js}"></script>
<!-- Magnific Popup -->
<script th:src="@{/client/js/jquery.magnific-popup.min.js}"></script>
<script th:src="@{/client/js/magnific-popup-options.js}"></script>

<!-- Stellar Parallax -->
<script th:src="@{/client/js/jquery.stellar.min.js}"></script>
<!-- Main -->
<script th:src="@{/client/js/main.js}"></script>

<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->

<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    // $.widget.bridge('uibutton', $.ui.button)

     function sumAll(sum){
         $("#cartSumPrice>*").remove()
        $("#cartSumPrice").append(" <div class=\"total\">\n" +
            "                                <div class=\"sub\">\n" +
            "                                    <p><span>Tổng:</span> <span class=\"sumPrice\">"+sum+"</span></p>\n" +
            "                                </div>\n" +
            "                                <div class=\"grand-total\">\n" +
            "                                    <p><span><strong>Tổng cộng:</strong></span> <span class=\"sumPrice\">"+sum+"</span></p>\n" +
            "                                    <a href=\"http://localhost:8080/order/list\" id=\"checkout\" class=\"btn btn-primary\">Thanh toán <i\n" +
            "                                            class=\"icon-arrow-right-circle\"></i></a>\n" +
            "                                </div>\n" +
            "                            </div>")
    }
    
    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: "http://localhost:8080/user-api",
            async: false,
            success: function (user) {
                // let sum = 0
                $.ajax({
                    type: 'GET',
                    async: false,
                    url: 'http://localhost:8080/cart-api?userid='+user.id,
                    success: function (carts) {
                        let sum = 0
                        carts.forEach(cart => {
                            $.ajax({
                                type: 'GET',
                                async: false,
                                url: 'http://localhost:8080/productdetails-api?productId='+cart.productId,
                                success: function (productDetails) {
                                    $.ajax({
                                        type: 'GET',
                                        url: 'http://localhost:8080/product-api/product?productId='+productDetails.productId,
                                        success: function (product){
                                            sum += (product.price)*(cart.quantity)
                                            // console.log(product)
                                            // console.log(productDetails)
                                            // console.log(cart)
                                            $("#cartList").append("  <div class=\"product-cart\">\n" +
                                                "                    <div class=\"one-forth\">\n" +
                                                "                        <div class=\"product-img\">\n" +
                                                "                            <img class=\"img-thumbnail cart-img\" src=\""+product.logo+"\">\n" +
                                                "                        </div>\n" +
                                                "                        <div class=\"detail-buy\">\n" +
                                                "                            <h4>"+productDetails.id+"</h4>\n" +
                                                "                            <h5>"+product.name+"</h5>\n" +
                                                "                        </div>\n" +
                                                "                    </div>\n" +
                                                "                    <div class=\"one-eight text-center\">\n" +
                                                "                        <div class=\"display-tc\">\n" +
                                                "                            <span class=\"price\">"+product.price+"</span>\n" +
                                                "                        </div>\n" +
                                                "                    </div>\n" +
                                                "                    <div class=\"one-eight text-center\">\n" +
                                                "                        <div class=\"display-tc\">\n" +
                                                "                            <input type=\"number\" id=\"quantity\" name=\"quantity\"\n" +
                                                "                                   class=\"form-control input-number text-center\" value=\""+cart.quantity+"\">\n" +
                                                "                        </div>\n" +
                                                "                    </div>\n" +
                                                "                    <div class=\"one-eight text-center\">\n" +
                                                "                        <div class=\"display-tc\">\n" +
                                                "                            <span class=\"priceAll\">"+product.price*cart.quantity+"</span>\n" +
                                                "                        </div>\n" +
                                                "                    </div>\n" +
                                                "                    <div class=\"one-eight text-center\">\n" +
                                                "                        <div class=\"display-tc\">\n" +
                                                "                            <a href=\"http://localhost:8080/cart/delete?cartId="+cart.id+"\" class=\"closed\"></a>\n" +
                                                "                        </div>\n" +
                                                "                    </div>\n" +
                                                "                </div>")
                                            sumAll(sum)
                                        }
                                    })
                                }
                            })
                        })

                    }
                })
            }
        })

    })
    $("#checkout").click(function () {
        $.ajax({
            type: 'GET',
            url: 'http://localhost:8080/user-api',
            success: function (user) {
                $.ajax({
                    type: 'POST',
                    url: 'http://localhost:8080/cart/carttoorder?userId='+user.id
                })
            }
        })
    })
    
</script>

<!--<script src="http://code.jquery.com/jquery-1.9.1.js"></script>-->
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

</body>

</html>